# RelaScope Insight IPC通信架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                             渲染进程 (Renderer Process)                   │
│                                                                         │
│  ┌─────────────────────────────┐      ┌──────────────────────────────┐  │
│  │       IPC服务模块            │      │        业务服务模块           │  │
│  │   (IPC Service Module)      │      │   (Business Service Module)  │  │
│  │                             │      │                              │  │
│  │ ┌─────────────────────────┐ │      │ ┌────────────────────────┐   │  │
│  │ │      IpcService类       │ │      │ │   ProfileService       │   │  │
│  │ │   - invoke()            │◄┼──────┼─┤   - getAllProfiles()   │   │  │
│  │ │   - send()              │ │      │ │   - createProfile()    │   │  │
│  │ │   - on()                │ │      │ │   - updateProfile()    │   │  │
│  │ │   - once()              │ │      │ └────────────────────────┘   │  │
│  │ │   - removeListener()    │ │      │                              │  │
│  │ └─────────────────────────┘ │      │ ┌────────────────────────┐   │  │
│  │                             │      │ │   QuoteService         │   │  │
│  │ ┌─────────────────────────┐ │      │ │   - getAllQuotes()     │   │  │
│  │ │    通道常量定义          │◄┼──────┼─┤   - createQuote()      │   │  │
│  │ │  (Channel Constants)    │ │      │ │   - deleteQuote()      │   │  │
│  │ └─────────────────────────┘ │      │ └────────────────────────┘   │  │
│  └─────────────────────────────┘      └──────────────────────────────┘  │
└─────────────────────────────┬───────────────────────┬─────────────────────┘
                              │                       │
                     IPC请求  │                       │ IPC响应
                              │                       │
                              ▼                       │
┌─────────────────────────────────────────────────────────────────────────┐
│                            预加载脚本 (Preload Script)                   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                     contextBridge.exposeInMainWorld              │    │
│  │                                                                  │    │
│  │  ┌──────────────────────────┐     ┌──────────────────────────┐   │    │
│  │  │     electron API         │     │      IPC常量              │   │    │
│  │  │  - invoke()              │     │   - CONFIG_CHANNELS      │   │    │
│  │  │  - send()                │     │   - APP_CHANNELS         │   │    │
│  │  │  - receive()             │     │   - DB_CHANNELS          │   │    │
│  │  │  - removeListener()      │     │   - PROFILE_CHANNELS     │   │    │
│  │  └──────────────────────────┘     └──────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────┬───────────────────────┬─────────────────────┘
                              │                       │
                     IPC请求  │                       │ IPC响应
                              │                       │
                              ▼                       │
┌─────────────────────────────────────────────────────────────────────────┐
│                             主进程 (Main Process)                        │
│                                                                         │
│  ┌─────────────────────────────┐      ┌──────────────────────────────┐  │
│  │        IPC处理器             │      │          业务逻辑层           │  │
│  │    (IPC Handlers)           │      │    (Business Logic Layer)    │  │
│  │                             │      │                              │  │
│  │ ┌─────────────────────────┐ │      │ ┌────────────────────────┐   │  │
│  │ │   ipcMain.handle()      │ │      │ │   数据库服务            │   │  │
│  │ │   - profile:create      │─┼─────►│ │   - ProfileDAO         │   │  │
│  │ │   - profile:update      │ │      │ │   - QuoteDAO           │   │  │
│  │ │   - quote:getAll        │ │      │ │   - ExperienceDAO      │   │  │
│  │ └─────────────────────────┘ │      │ └────────────────────────┘   │  │
│  │                             │      │                              │  │
│  │ ┌─────────────────────────┐ │      │ ┌────────────────────────┐   │  │
│  │ │   ipcMain.on()          │ │      │ │   配置管理              │   │  │
│  │ │   - app:minimize        │─┼─────►│ │   - ConfigManager      │   │  │
│  │ │   - app:maximize        │ │      │ │   - AppSettingsManager │   │  │
│  │ │   - app:quit            │ │      │ └────────────────────────┘   │  │
│  │ └─────────────────────────┘ │      │                              │  │
│  └─────────────────────────────┘      └──────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

## 通信流程

1. **渲染进程请求流程**：
   - 业务服务模块调用IPC服务模块的方法
   - IPC服务模块通过预加载脚本暴露的API发送请求
   - 请求传递到主进程的IPC处理器
   - IPC处理器调用业务逻辑层处理请求
   - 业务逻辑层返回结果给IPC处理器
   - IPC处理器将响应发送回渲染进程

2. **主进程通知流程**：
   - 主进程业务逻辑层触发事件
   - IPC处理器发送通知消息
   - 消息通过预加载脚本传递到渲染进程
   - 渲染进程IPC服务模块接收通知
   - 业务服务模块处理通知并更新UI

## 数据流格式

每个IPC请求和响应都遵循标准格式：

**请求格式**:
```javascript
{
  // 请求参数 (取决于具体通道)
}
```

**响应格式**:
```javascript
{
  success: boolean,  // 操作是否成功
  data?: any,        // 成功时返回的数据
  error?: string     // 失败时的错误信息
}
``` 